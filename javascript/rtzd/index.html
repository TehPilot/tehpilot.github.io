<html>
<head>
<title>really terrible zombie defense</title>

<script type="text/javascript">
var titleScan = false;
var mnm = 0;

var title1 = new Array();
title1[0]  = "~ in progress ";
title1[1]  = " in progress ~";
title1[2]  = "in progress ~ ";
title1[3]  = "n progress ~ i";
title1[4]  = " progress ~ in";
title1[5]  = "progress ~ in ";
title1[6]  = "rogress ~ in p";
title1[7]  = "ogress ~ in pr";
title1[8]  = "gress ~ in pro";
title1[9]  = "ress ~ in prog";
title1[10] = "ess ~ in progr";
title1[11] = "ss ~ in progre";
title1[12] = "s ~ in progres";
title1[13] = " ~ in progress";

function titleTimers () {
var a1 = setInterval(scrollTitle,100);
}

function scrollTitle () {
	if (titleScan == true ) {
	document.title = title1[mnm];
	mnm++;
	if (mnm > 13) {
		mnm = 0;
	}
	}
	else { document.title = "really terrible zombie defense";
	}
	}


var personalBest = 0;

function getCookie(c_name)
{
var i,x,y,ARRcookies=document.cookie.split(";");
for (i=0;i<ARRcookies.length;i++)
  {
  x=ARRcookies[i].substr(0,ARRcookies[i].indexOf("="));
  y=ARRcookies[i].substr(ARRcookies[i].indexOf("=")+1);
  x=x.replace(/^\s+|\s+$/g,"");
  if (x==c_name)
    {
    return unescape(y);
	alert(y);
    }
  else
	{
	  setCookie("highscore",0,365);
	}
  }
}

function setCookie(c_name,value,exdays)
{
var exdate=new Date();
exdate.setDate(exdate.getDate() + exdays);
var c_value=escape(value) + ((exdays==null) ? "" : "; expires="+exdate.toUTCString());
document.cookie=c_name + "=" + c_value;
}

function checkCookie()
{
personalBest=getCookie("highscore");
if (personalBest!=0 || isNaN(personalBest) == true )
  {
  document.getElementById("score").innerHTML=personalBest;
  }
else 
  {
  document.getElementById("score").innerHTML="0";
  setCookie("highscore",0,365);
  }
}

function resetCookie() {
	var r=confirm("Clear the highscore data?");
	if (r==true)
  {
  setCookie("highscore",0,365);
    checkCookie();
  }
else
  {
  checkCookie();
updateStats();
  }
}

function roundedToFixed(_float, _digits){
  var rounder = Math.pow(10, _digits);
  return (Math.round(_float * rounder) / rounder).toFixed(_digits);
}

var healthCheck = setInterval(checkHealth,100);

function checkHealth() {
if (globalHealth < 0) { alert('Game over! Your fortress was overrun on Wave ' + wave + '.');
						clearInterval(healthCheck);
						wave -= 1;
						window.location.reload(true); }
}

var globalHealthLimit = 100;
var globalHealth = 100;
var globalMoney = 300;
var globalDefense = 3;
var globalAttack = 3;
var zombieCount = 0;
var size=10;
var wave=1;
var isFirstTurn = false;

var a;
var b;
var c;

var perkBought = false;

var firstStrikeBuy = true;
var firstStrike = false;
var firstStrikePrice = 550;
var investmentPlanBuy = true;
var investmentPlan = false;
var investmentPlanPrice = 1200;
var cleansingFireBuy = true;
var cleansingFire = false;
var cleansingFirePrice = 800;
var shieldBuy = true;
var shieldPrice = 950;

var count1 = 10;
var count2 = 10;
var count3 = 10;
var count4 = 100;
var count5 = 75;
var count6 = 100;
var count7 = 35;

var globalAttackTimer = 1.5;
var globalHealTimer = 3;
var globalHeal = 10;
var globalWeakness = 8;
var weaknessCheck = globalWeakness;
var zombieSpeed = 600;
var levelIncrease = 15;

var canMove = true;
var skipWave = false;
var canSkipWave = true;

function damage() {
if (zombieCount > 0) {
var zattack = Math.round(Math.round((zombieCount) - globalDefense)*0.75);
weaknessCheck = Math.floor(Math.random()*globalWeakness) + 1;
if (zattack < 1) { zattack=0; }
if (globalWeakness == weaknessCheck) { zattack *= (globalWeakness / 10); }
zattack = Math.round(zattack);
globalHealth -= zattack;
updateStats();
}
}

function attack() {
if (zombieCount > 0) {
if (cleansingFire==true) {
	zombieCount = 0;
	cleansingFire = false;
	}
if (firstStrike==true && isFirstTurn==true) {
zombieCount -= Math.round((globalAttack * 1.5) * 2.5);
isFirstTurn = false;
}
else {
zombieCount -= Math.round(globalAttack * 1.5);
isFirstTurn = false; }
}
if (zombieCount < 1) {
zombieCount = 0;
a=window.clearInterval(a);
b=window.clearInterval(b);
c=window.clearInterval(c);
titleScan = false;
canMove = true;
size *= 1.2;
wave += 1;
if (investmentPlan==true) {
globalMoney += Math.round(size * 3.2); }
else {
globalMoney += Math.round(size * 2.2);}
size = Math.round(size);
//alert(wave + " _ " + levelIncrease);
if (wave == levelIncrease && zombieSpeed > 25) {
alert('Round complete!\n\nZombie attack speed increased!\nAll perks reset!');
document.getElementById("gamebutton").innerHTML="Begin wave " + wave + "";
levelIncrease += 15;
zombieSpeed -= 25;
firstStrike = false;
investmentPlan = false;
cleansingFire = false;
perkBought = false;
firstStrikeBuy = true;
investmentPlanBuy = true;
cleansingFireBuy = true;
shieldBuy = true;
shieldPrice = Math.round(shieldPrice * 4);
firstStrikePrice = Math.round(firstStrikePrice * 3.5);
investmentPlanPrice = Math.round(investmentPlanPrice * 7);
cleansingFirePrice = Math.round(cleansingFirePrice * 7);
document.getElementById("fstr").innerHTML='First Strike ($' + firstStrikePrice + ')';
document.getElementById("invp").innerHTML='Investment Plan ($' + investmentPlanPrice + ')';
document.getElementById("shld").innerHTML='Shield ($' + shieldPrice + ')';
//document.getElementById("cfir").innerHTML='Cleansing Fire ($' + cleansingFirePrice + ')';
document.getElementById("perks").innerHTML='Perks (Active: None)';
}
else if (wave==400) {
	alert('You have managed to technically reach the end of the game. I am really impressed, not gonna lie.\n\nExcellent work, soldier. You have survived the zombie apocalypse.');
	throw new Error('');
	}
updateStats();
checkCookie();
if (personalBest < wave) {
setCookie("highscore",(wave - 1),365);
}
checkCookie();
document.getElementById("gamebutton").innerHTML="Begin wave " + wave + "";
}
}

function heal() {
if (globalHealth < globalHealthLimit) {
if (zombieCount > 0) {
if (globalHealth < globalHealthLimit) {
globalHealth += globalHeal; }
if (globalHealth > globalHealthLimit) {
globalHealth = globalHealthLimit;
}
updateStats();
}
}
}

function updateStats () {
document.getElementById("stats").innerHTML="Current fortress health: " + globalHealth + "/" + globalHealthLimit + "<br>Attack: " + globalAttack + " | Defense: " + globalDefense + " | Fortifications: " + Math.abs(globalWeakness - 8) + "/6<br>Repair rate: " + globalHeal + " HP every " + globalHealTimer + " sec | Rate of Fire: 1 attack every " + globalAttackTimer + " sec<br>Monies: $" + globalMoney + "<br>Zombies: " + zombieCount + "";
}

function turn() {
if (canMove == true) {
titleScan = true;
canMove = false;
zombieCount = size;
if (skipWave == true) {
zombieCount = 0;
}
document.getElementById("gamebutton").innerHTML="In progress...";
isFirstTurn = true;
a=self.setInterval(damage,zombieSpeed);
b=self.setInterval(attack,globalAttackTimer*1000);
c=self.setInterval(heal,globalHealTimer*1000);

}
}

function buyAttack() {
	if (globalMoney >= count1 && canMove == true) {
	globalAttack = Math.round(globalAttack * 1.3);
	globalMoney -= count1;
	count1 = Math.round(count1 * 1.3);
	document.getElementById("atk").innerHTML='+Attack ($' + count1 + ')';
	updateStats();
	}
}

function buyRateofFire() {
	if (globalMoney >= count4 && canMove == true && globalAttackTimer > 0.1) {
	globalAttackTimer -= 0.2;
	globalAttackTimer = roundedToFixed(globalAttackTimer, 1);
	globalMoney -= count4;
	count4 = Math.round(count4 * 1.5);
	document.getElementById("rof").innerHTML='+Rate of Fire ($' + count4 + ')';
	if (globalAttackTimer == 0.1) { document.getElementById("rof").innerHTML='+Rate of Fire ($----)'; }
	updateStats();
	}
}

function buyRepairRate() {
	if (globalMoney >= count6 && canMove == true && globalHealTimer > 1.0) {
	globalHealTimer -= 0.4;
	globalHealTimer = roundedToFixed(globalHealTimer, 1);
	globalMoney -= count6;
	count6 = Math.round(count6 * 1.5);
	document.getElementById("rpr").innerHTML='+Auto-Repair Rate ($' + count6 + ')';
	if (globalHealTimer == 1.0) { document.getElementById("rpr").innerHTML='+Auto-Repair Rate ($----)'; }
	updateStats();
	}
}

function buyStrength() {
	if (globalMoney >= count7 && canMove == true && globalWeakness > 2.0) {
	globalWeakness -= 1;
	globalMoney -= count7;
	count7 = Math.round(count7 * 1.75);
	document.getElementById("str").innerHTML='Add Fortifications ($' + count7 + ')';
	if (globalWeakness < 3.0) { document.getElementById("str").innerHTML='Add Fortifications ($----)'; }
	updateStats();
	}
}

function buyDefense() {
	if (globalMoney >= count2 && canMove == true) {
	globalDefense = Math.round(globalDefense * 1.3);
	globalMoney -= count2;
	count2 = Math.round(count2 * 1.3);
	document.getElementById("def").innerHTML='+Defense ($' + count2 + ')';
	updateStats();
	}
}

function buyHealing() {
	if (globalMoney >= count3 && canMove == true) {
	globalHeal = Math.round(globalHeal * 1.3);
	globalMoney -= count3;
	count3 = Math.round(count3 * 1.5);
	document.getElementById("hlt").innerHTML='+Auto-Repair ($' + count3 + ')';
	updateStats();
	}
}

function buyHealth() {
	if (globalMoney >= count5 && canMove == true) {
	globalHealthLimit = Math.round(globalHealthLimit * 1.3);
	globalHealth = Math.round(globalHealth * 1.3);
	globalMoney -= count5;
	count5 = Math.round(count5 * 1.5);
	document.getElementById("ghl").innerHTML='+Health ($' + count5 + ')';
	updateStats();
	}
}

function buyRepairs() {
	if (globalMoney >= 5 && canMove == true && globalHealth < globalHealthLimit) {
	globalHealth += 5;
	globalMoney -= 5;
	if (globalHealth > globalHealthLimit) { globalHealth = globalHealthLimit; }
	document.getElementById("rep").innerHTML='+Repair ($5)';
	updateStats();
	}
}

function buyFirstStrike() {
	if (globalMoney >= firstStrikePrice && canMove == true && firstStrikeBuy == true && perkBought == false) {
		if (confirm('You are about to buy the First Strike perk.\n\nThis perk will greatly increase the damage of your first attack in each wave. This perk can only be used once every fifteen-wave block.\n\nAre you sure you want to buy this upgrade?')) {
		globalMoney -= firstStrikePrice;
		firstStrike = true;
		perkBought = true;
		document.getElementById("fstr").innerHTML='First Strike ($----)';
		document.getElementById("perks").innerHTML='Perks (Active: First Strike)';
		updateStats();
		}
	}
}

function buyInvestmentPlan() {
	if (globalMoney >= investmentPlanPrice && canMove == true && investmentPlanBuy == true && perkBought == false) {
		if (confirm('You are about to buy the Investment Plan perk.\n\nThis perk will slightly increase the monetary award from each wave. This perk can only be used once every fifteen-wave block.\n\nAre you sure you want to buy this upgrade?')) {
		globalMoney -= investmentPlanPrice;
		investmentPlan = true;
		perkBought = true;
		document.getElementById("invp").innerHTML='Investment Plan ($----)';
		document.getElementById("perks").innerHTML='Perks (Active: Investment Plan)';
		updateStats();
		}
	}
}

function buyShield() {
	if (globalMoney >= shieldPrice && canMove == true && shieldBuy == true && perkBought == false) {
		if (confirm('You are about to buy the Shield perk.\n\nThis perk will fully heal your fortress and provide a 50% health buffer. This extra health cannot regenerate. This perk can only be used once every fifteen-wave block.\n\nAre you sure you want to buy this upgrade?')) {
		globalMoney -= shieldPrice;
		globalHealth = Math.round(globalHealth * 1.5);
		perkBought = true;
		document.getElementById("shld").innerHTML='Shield ($----)';
		document.getElementById("perks").innerHTML='Perks (Active: Shield)';
		updateStats();
		}
	}
}

/*function buyCleansingFire() {
	alert('debug');
	if (globalMoney >= cleansingFirePrice && canMove == true && cleansingFireBuy == true && perkBought == false) {
		if (confirm('You are about to buy the Cleansing Fire perk.\n\nThis perk will completely nullify the next wave of zombies, and can only be used once every fifteen-wave block.\n\nAre you sure you want to buy this upgrade?')) {
		globalMoney -= cleansingFirePrice;
		cleansingFire = true;
		perkBought = true;
		document.getElementById("cfir").innerHTML='Cleansing Fire ($----)';
		document.getElementById("perks").innerHTML='Perks (Active: Cleansing Fire)';
		updateStats();
		}
	}
}
*/
function skipWave() {
	alert('Checking...');
	if (globalMoney >= 350 && canMove == true && canSkipWave == true) {
	alert('Checked!');
	globalMoney -= 350;
	skipWave = true;
	canSkipWave = false;
	document.getElementById("aaa").innerHTML='Skip Wave ($----)';
	updateStats();
	}
}


</script>

<style>
body
{
background-color:#38333D;
color:#FFF;
}
/*button {
	background-color:#6F6678;
	border: 2px solid white;
	color:#FFF;
	}
button:active {
	background-color:#6F6678;
	border: 2px solid #708090;
	color:#C0C0C0;
	}
button:hover {
	background-color:#564963;
	border: 2px solid #708090;
	color:#C0C0C0;
	}*/
table {
	border-collapse:collapse;
	}
table, th, td {
	border: 2px solid #FFF;
	}-->

a:link {color:#708090;}      /* unvisited link */
a:visited {color:#778899;}  /* visited link */
a:hover {color:#C0C0C0;}  /* mouse over link */
a:active {color:#D3D3D3;}  /* selected link */
</style>

</head>

<body onload="updateStats(); checkCookie(); titleTimers()"><center><h1>really terrible zombie defense?</h1>
<h4>by <a href="http://tehpilot.tumblr.com/">TehPilot</a></h2><br>

<font face="Courier New"><code id="castle">
|¯|_|¯|_|¯|_|¯|_|¯|<br>
|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<br>
|&nbsp;&nbsp;&nbsp;&nbsp;_&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_&nbsp;&nbsp;&nbsp;&nbsp;|<br>
|&nbsp;&nbsp;&nbsp;|+|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|+|&nbsp;&nbsp;&nbsp;|<br>
|&nbsp;&nbsp;&nbsp;&nbsp;¯&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;¯&nbsp;&nbsp;&nbsp;&nbsp;|<br>
|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<br>
|_______|¯|_______|<br></code>
</font>
<br><br>
<div id="stats"></div><br><button id="gamebutton" onclick="turn()">Begin wave 1</button>
<br><br><br>
<table>
	<tr>
		<th colspan="4">Stats</th>
	</tr>
	<tr>
		<th>Attack</th>
		<th>Defense</th>
		<th>Health</th>
		<th>Auto-Repair</th>
	</tr>
	<tr>
		<td><center><button id="atk" onclick="buyAttack()">+Attack ($10)</button><br><button id="rof" onclick="buyRateofFire()">+Rate of Fire ($100)</button></center></td>
		<td><center><button id="def" onclick="buyDefense()">+Defense ($10)</button><br><button id="str" onclick="buyStrength()">Add Fortifications ($35)</button></center></td>
		<td><center><button id="ghl" onclick="buyHealth()">+Health ($75)</button><br><button id="rep" onclick="buyRepairs()">Repair ($5)</button></center></td>
		<td><center><button id="hlt" onclick="buyHealing()">+Auto-Repair ($10)</button><br><button id="rpr" onclick="buyRepairRate()">+Auto-Repair Rate ($100)</button></center></td>
	</tr>
	<tr>
		<th colspan="4" id="perks">Perks (Active: None)</th>
	</tr>
	<tr>
		<td><center><button id="fstr" onclick="buyFirstStrike()">First Strike ($550)</button></center></td>
		<td><center><button id="invp" onclick="buyInvestmentPlan()">Investment Plan ($1200)</button></center></td>
		<td><center><button id="shld" onclick="buyShield()">Shield ($950)</button></center></td>
	</tr>
</table>
<br>
<table>
	<tr>
		<th colspan="4">Highest Wave Completed:</th>
	</tr>
	<tr>
		<td><center><div id="score">--</div></center></td>
	</tr>
	<tr>
		<td><center><button onclick="resetCookie()">Reset</button></td>
	</tr>
</table>
<br>
<h3>how to play:</h3>
<p>Fend of groups of zombies in waves, and buy upgrades to avoid succumbing to the increasing hordes of the walking dead.
</center>
</body>
</html>